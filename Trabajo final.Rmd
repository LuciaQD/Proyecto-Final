---
title: "Siniestros de tránsito en Uruguay"
author: "Bruno Bellagamba y Lucía Quintero"
date: "Junio 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Introducción

El siguiente trabajo se enmarca dentro de la materia "Nuevas tecnologías para el análisis estadístico de datos" de la carrera Licenciatura en Estadística.  

El principal objetivo del mismo es aplicar las técnicas aprendidas en el curso para realizar el an?lisis exploratorio de los datos seleccionados, lo cu?l tambi?n implica incluir visualizaciones apropiadas y una buena interpretaci?n de las mismas.
Como objetivos adicionales se busca que el trabajo sea completamente reproducible y est? disponible en GitHub para colaboraciones futuras, y poder comunicar los principales resultados del mismo mediante una aplicaci?n shiny.

Para alcanzar los objetivos planteados se utilizan diversas herramientas de R destac?ndose el uso del paquete *tidyverse*, en particular los paquetes *dplyr* y *ggplot*.
Tambi?n cabe destacar el uso de *rmarkdown* para la realizaci?n del presente informe y el paquete *shiny* para realizarla aplicaci?n con los principales resultados.

La metodolog?a para realizar el an?lisis exploratorio consiste en realizar preguntas de inter?s y responderlas a trav?s del uso de las herramientas anteriormente mencionadas.

## Datos

Los datos seleccionados para el presente trabajo corresponden a los siniestros de tr?nsito ocurridos en Uruguay en el per?odo 2013-2017. Los mismos se obtuvieron de la p?gina web de la UNASEV *(ver enlace en la secci?n Bibliograf?a)* Se selecciona esta base para trabajar ya que se considera un tema de inter?s a nivel nacional y sobre el cu?l se trabaja continuamente con el fin de disminuir la cantidad de siniestros.

La base cuenta con 149.377 observaciones carrespondientes cada una a un siniestro de tr?nsito, y 10 variables que representan detalles de los mismos como el lugar, gravedad, fecha y hora y tipo de siniestro.
Para poder realizar un mejor an?lisis se agregaron las variables A?o y Mes, totalizando 12 variables para trabajar.

A partir de una primera aproximaci?n con los datos se observa que la mayor?a de las variables son cualitativas (Calle, Tipo de siniestro, Gravedad, D?a de la semana, Departamento, Localidad), y las restantes cuantitativas (A?o, Mes, Hora, longitud, latitud). **VER SI ESTO ES AS? Y QUE PASA CON LA FECHA**. En principio no se detecta la presencia de datos faltantes.

Para el an?lisis se decide trabajar con las variables Tipo de siniestro, Gravedad, D?a de la semana, Departamento, Hora, A?o y Mes. **Si nos da el tiempo incluimos latitud y longitud parael mapa en shiny, sino lo agregamos en comentarios finales como posible trabajo futuro**  

```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(lubridate)

#1 Subimos los archivos

Este_2013 <- read_csv("Siniestros/2013/Este_2013.txt")
Oeste_2013 <- read_csv("Siniestros/2013/Oeste_2013.txt")
Norte_2013 <- read_csv("Siniestros/2013/Norte_2013.txt")
Montevideo_2013 <- read_csv("Siniestros/2013/Montevideo_2013.txt")

Este_2014 <- read_csv("Siniestros/2014/Este_2014.txt")
Oeste_2014 <- read_csv("Siniestros/2014/Oeste_2014.txt")
Norte_2014 <- read_csv("Siniestros/2014/Norte_2014.txt")
Montevideo_2014 <- read_csv("Siniestros/2014/Montevideo_2014.txt")

Este_2015 <- read_csv("Siniestros/2015/Este_2015.txt")
Oeste_2015 <- read_csv("Siniestros/2015/Oeste_2015.txt")
Norte_2015 <- read_csv("Siniestros/2015/Norte_2015.txt")
Montevideo_2015 <- read_csv("Siniestros/2015/Montevideo_2015.txt")

Este_2016 <- read_csv("Siniestros/2016/Este_2016.txt")
Oeste_2016 <- read_csv("Siniestros/2016/Oeste_2016.txt")
Norte_2016 <- read_csv("Siniestros/2016/Norte_2016.txt")
Montevideo_2016 <- read_csv("Siniestros/2016/Montevideo_2016.txt")

Este_2017 <- read_csv("Siniestros/2017/Este_2017.txt")
Oeste_2017 <- read_csv("Siniestros/2017/Oeste_2017.txt")
Norte_2017 <- read_csv("Siniestros/2017/Norte_2017.txt")
Montevideo_2017 <- read_csv("Siniestros/2017/Montevideo_2017.txt")

#2 Armamos las bases por a?o

base2013 <- bind_rows(Este_2013, Oeste_2013, Norte_2013, Montevideo_2013)
base2014 <- bind_rows(Este_2014, Oeste_2014, Norte_2014, Montevideo_2014) 
base2015 <- bind_rows(Este_2015, Oeste_2015, Norte_2015, Montevideo_2015) 
base2016 <- bind_rows(Este_2016, Oeste_2016, Norte_2016, Montevideo_2016)  
base2017 <- bind_rows(Este_2017, Oeste_2017, Norte_2017,Montevideo_2017)

#3 Armamos la base de todos los a?os, cambiamos los nombres de las variables con espacio en el mismo y agregamos las variables A?o y Mes 

datos <- as.data.frame(bind_rows(base2013, base2014, base2015, base2016, base2017)) %>% 
  rename_at(3, ~"Tipo_de_siniestro") %>%  
  rename_at(5, ~ "Dia_semana") %>%
  mutate(A?o = year(as.Date(Fecha, "%d/%m/%Y")), Mes = month(as.Date(Fecha, "%d/%m/%Y")))


s <- summary(datos)

```

## An?lisis Exploratorio

Comenzamos con un an?lisis temporal intentando ver las variaciones en los a?os, meses, dias de la semana y hora de los siniestros

En primer lugar nos planteamos cuantficar el n?mero de siniestros en los diferentes a?os de an?lisis para luego realizar un gr?fico de barras donde pretendemos ver la variaci?n de los mismos.

```{r, echo = FALSE, warning = FALSE, message = FALSE, fig.cap = cap1, fig.width = 5, fig.height = 4}

#Resumen de datos
r <- datos %>%
      group_by(A?o) %>%
      summarise(Cantidad = n())

#Gr?fico
datos %>%
  ggplot(aes(x = A?o)) + 
  geom_bar(fill = "seagreen4") +
  labs(x = "A?o", y = "Cantidad") +
  ggtitle("Siniestros por a?o") 

cap1 <- "A partir del gr?fico podemos observar que del a?o 2013 al 2015 hubo un incremento sostenido en la cantidad de siniestros habiendo un decenso en el a?o 2016 para volver a crecer en el 2017. De todas formas no se observa una variaci?n importante a lo largo del periodo."

```

grafico por mes por a?o
grafico por dia de la semana por a?o
grafico por hora por a?o 



## Aplicaci?n Shiny

## Comentarios finales

## Bibliograf?a

- R for Data Science - Garrett Grolemund, Hadley Wickham (<http://r4ds.had.co.nz/>)  
- ggplot2 Elegant Graphics for Data Analysis - Hadley Wickham  
- Datos: P?gina web UNASEV (<http://aplicaciones.unasev.gub.uy/mapas/AdministracionMapaIndicadores/AdministracionMapaIndicadores_Alta>)

###Cosas para hacer
-Restar graficos irrelevantes
-Cambiar selectinput para año y variable(el filtro de año va afuera del if)
_Usar tags para comentarios
-Cambiar paleta de colores del mapa y cambiar la "variable" por la que contamos
-Grafico de series
-Extra:Generar mapa con puntos de concentracion